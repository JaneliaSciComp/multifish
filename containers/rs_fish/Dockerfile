# fd370bd163a9fec0bbb127fa09b2baf8f62d11e882d56a76543a83f5ed86729c
# Dockerfile generated by Maru 0.1.1

# Staged build using builder container
FROM janeliascicomp/builder:1.3.1 as builder
ARG GIT_TAG=main

# Checkout and build the code
WORKDIR /tmp/app
RUN git clone --branch $GIT_TAG --depth 1 https://github.com/PreibischLab/RS-FISH-Spark.git . \
    && /usr/local/bin/buildinfo.sh \
    && mvn package

# Create final image
FROM multifish/spark:3.0.1-hadoop3.2

COPY --from=builder /tmp/app/target/RS-Fish-jar-with-dependencies.jar /app/app.jar
COPY --from=builder /buildinfo /

RUN echo "#!/bin/bash" >> /entrypoint.sh \
    && echo 'java -cp /app/app.jar -Xmx20G -Dspark.master=local[8] net.preibisch.rsfish.spark.SparkRSFISH "$@"' >> /entrypoint.sh \
    && chmod +x /entrypoint.sh
#ENTRYPOINT [ "/entrypoint.sh"]
